

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Management Component Transport Protocol (MCTP) &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MPLS Sysfs variables" href="mpls-sysctl.html" />
    <link rel="prev" title="How to use packet injection with mac80211" href="mac80211-injection.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.16.0-rc1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux Networking Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="netdev-FAQ.html">netdev FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="af_xdp.html">AF_XDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="bareudp.html">Bare UDP Tunnelling Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="batman-adv.html">batman-adv</a></li>
<li class="toctree-l2"><a class="reference internal" href="can.html">SocketCAN - Controller Area Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="can_ucan_protocol.html">The UCAN Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_drivers/index.html">Hardware Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsa/index.html">Distributed Switch Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="devlink/index.html">Linux Devlink Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="caif/index.html">CAIF</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethtool-netlink.html">Netlink interface for ethtool</a></li>
<li class="toctree-l2"><a class="reference internal" href="ieee802154.html">IEEE 802.15.4 Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="j1939.html">J1939 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="kapi.html">Linux Networking and Network Devices APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="msg_zerocopy.html">MSG_ZEROCOPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="failover.html">FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="net_dim.html">Net DIM - Generic Network Dynamic Interrupt Moderation</a></li>
<li class="toctree-l2"><a class="reference internal" href="net_failover.html">NET_FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_pool.html">Page Pool API</a></li>
<li class="toctree-l2"><a class="reference internal" href="phy.html">PHY Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp-phylink.html">phylink</a></li>
<li class="toctree-l2"><a class="reference internal" href="alias.html">IP-Aliasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridge.html">Ethernet Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="snmp_counter.html">SNMP counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="checksum-offloads.html">Checksum Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="segmentation-offloads.html">Segmentation Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="scaling.html">Scaling in the Linux Networking Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="tls.html">Kernel TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="tls-offload.html">Kernel TLS offload</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfc.html">Linux NFC subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="6lowpan.html">Netdev private dataroom for 6lowpan interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="6pack.html">6pack Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="arcnet-hardware.html">ARCnet Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="arcnet.html">ARCnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="atm.html">ATM</a></li>
<li class="toctree-l2"><a class="reference internal" href="ax25.html">AX.25</a></li>
<li class="toctree-l2"><a class="reference internal" href="bonding.html">Linux Ethernet Bonding Driver HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdc_mbim.html">cdc_mbim - Driver for CDC MBIM Mobile Broadband modems</a></li>
<li class="toctree-l2"><a class="reference internal" href="dccp.html">DCCP protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="dctcp.html">DCTCP (DataCenter TCP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="decnet.html">Linux DECnet Networking Layer Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="dns_resolver.html">DNS Resolver Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="driver.html">Softnet Driver Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="eql.html">EQL Driver: Serial IP Load Balancing HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="fib_trie.html">LC-trie implementation notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter.html">Linux Socket Filtering aka Berkeley Packet Filter (BPF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic-hdlc.html">Generic HDLC layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_netlink.html">Generic Netlink</a></li>
<li class="toctree-l2"><a class="reference internal" href="gen_stats.html">Generic networking statistics for netlink users</a></li>
<li class="toctree-l2"><a class="reference internal" href="gtp.html">The Linux kernel GTP tunneling module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ila.html">Identifier Locator Addressing (ILA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ioam6-sysctl.html">IOAM6 Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipddp.html">AppleTalk-IP Decapsulation and AppleTalk-IP Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ip_dynaddr.html">IP dynamic address hack-port v0.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec.html">IPsec</a></li>
<li class="toctree-l2"><a class="reference internal" href="ip-sysctl.html">IP Sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipv6.html">IPv6</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipvlan.html">IPVLAN Driver HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipvs-sysctl.html">IPvs-sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="kcm.html">Kernel Connection Multiplexor</a></li>
<li class="toctree-l2"><a class="reference internal" href="l2tp.html">L2TP</a></li>
<li class="toctree-l2"><a class="reference internal" href="lapb-module.html">The Linux LAPB Module Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="mac80211-injection.html">How to use packet injection with mac80211</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Management Component Transport Protocol (MCTP)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#structure-interfaces-networks">Structure: interfaces &amp; networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sockets-api">Sockets API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#protocol-definitions">Protocol definitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#syscall-behaviour">Syscall behaviour</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#kernel-internals">Kernel internals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#key-refcounts">Key refcounts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mpls-sysctl.html">MPLS Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="mptcp-sysctl.html">MPTCP Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiqueue.html">HOWTO for multiqueue network device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="netconsole.html">Netconsole</a></li>
<li class="toctree-l2"><a class="reference internal" href="netdev-features.html">Netdev features mess and how to get out from it alive</a></li>
<li class="toctree-l2"><a class="reference internal" href="netdevices.html">Network Devices, the Kernel, and You!</a></li>
<li class="toctree-l2"><a class="reference internal" href="netfilter-sysctl.html">Netfilter Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="netif-msg.html">NETIF Msg Level</a></li>
<li class="toctree-l2"><a class="reference internal" href="nexthop-group-resilient.html">Resilient Next-hop Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="nf_conntrack-sysctl.html">Netfilter Conntrack Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="nf_flowtable.html">Netfilter’s flowtable infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="openvswitch.html">Open vSwitch datapath developer documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="operstates.html">Operational States</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_mmap.html">Packet MMAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="phonet.html">Linux Phonet protocol family</a></li>
<li class="toctree-l2"><a class="reference internal" href="pktgen.html">HOWTO for the linux packet generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="plip.html">PLIP: The Parallel Line Internet Protocol Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="ppp_generic.html">PPP Generic Driver and Channel Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="proc_net_tcp.html">The proc/net/tcp and proc/net/tcp6 variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="radiotap-headers.html">How to use radiotap headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="rds.html">RDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="regulatory.html">Linux wireless regulatory documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rxrpc.html">RxRPC Network Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="rxrpc.html#socket-options">SOCKET OPTIONS</a></li>
<li class="toctree-l2"><a class="reference internal" href="rxrpc.html#security">SECURITY</a></li>
<li class="toctree-l2"><a class="reference internal" href="rxrpc.html#example-client-usage">EXAMPLE CLIENT USAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="sctp.html">Linux Kernel SCTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="secid.html">LSM/SeLinux secid</a></li>
<li class="toctree-l2"><a class="reference internal" href="seg6-sysctl.html">Seg6 Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="statistics.html">Interface statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="strparser.html">Stream Parser (strparser)</a></li>
<li class="toctree-l2"><a class="reference internal" href="switchdev.html">Ethernet switch device driver model (switchdev)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysfs-tagging.html">Sysfs tagging</a></li>
<li class="toctree-l2"><a class="reference internal" href="tc-actions-env-rules.html">TC Actions - Environmental Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="tcp-thin.html">Thin-streams and TCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="team.html">Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="timestamping.html">Timestamping</a></li>
<li class="toctree-l2"><a class="reference internal" href="tipc.html">Linux Kernel TIPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="tproxy.html">Transparent proxy support</a></li>
<li class="toctree-l2"><a class="reference internal" href="tuntap.html">Universal TUN/TAP device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="udplite.html">The UDP-Lite protocol (RFC 3828)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vrf.html">Virtual Routing and Forwarding (VRF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vxlan.html">Virtual eXtensible Local Area Networking documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="x25-iface.html">Packet Layer to Device Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="x25-iface.html#device-driver-to-packet-layer">Device Driver to Packet Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="x25-iface.html#requirements-for-the-device-driver">Requirements for the device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="x25.html">Linux X.25 Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfrm_device.html">XFRM device - offloading the IPsec computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfrm_proc.html">XFRM proc - /proc/net/xfrm_* files</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfrm_sync.html">XFRM</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfrm_sysctl.html">XFRM Syscall</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Linux Networking Documentation</a> &raquo;</li>
        
      <li>Management Component Transport Protocol (MCTP)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/networking/mctp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="management-component-transport-protocol-mctp">
<h1>Management Component Transport Protocol (MCTP)<a class="headerlink" href="#management-component-transport-protocol-mctp" title="Permalink to this headline">¶</a></h1>
<p>net/mctp/ contains protocol support for MCTP, as defined by DMTF standard
DSP0236. Physical interface drivers (“bindings” in the specification) are
provided in drivers/net/mctp/.</p>
<p>The core code provides a socket-based interface to send and receive MCTP
messages, through an AF_MCTP, SOCK_DGRAM socket.</p>
<div class="section" id="structure-interfaces-networks">
<h2>Structure: interfaces &amp; networks<a class="headerlink" href="#structure-interfaces-networks" title="Permalink to this headline">¶</a></h2>
<p>The kernel models the local MCTP topology through two items: interfaces and
networks.</p>
<p>An interface (or “link”) is an instance of an MCTP physical transport binding
(as defined by DSP0236, section 3.2.47), likely connected to a specific hardware
device. This is represented as a <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">netdevice</span></code>.</p>
<p>A network defines a unique address space for MCTP endpoints by endpoint-ID
(described by DSP0236, section 3.2.31). A network has a user-visible identifier
to allow references from userspace. Route definitions are specific to one
network.</p>
<p>Interfaces are associated with one network. A network may be associated with one
or more interfaces.</p>
<p>If multiple networks are present, each may contain endpoint IDs (EIDs) that are
also present on other networks.</p>
</div>
<div class="section" id="sockets-api">
<h2>Sockets API<a class="headerlink" href="#sockets-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="protocol-definitions">
<h3>Protocol definitions<a class="headerlink" href="#protocol-definitions" title="Permalink to this headline">¶</a></h3>
<p>MCTP uses <code class="docutils literal notranslate"><span class="pre">AF_MCTP</span></code> / <code class="docutils literal notranslate"><span class="pre">PF_MCTP</span></code> for the address- and protocol- families.
Since MCTP is message-based, only <code class="docutils literal notranslate"><span class="pre">SOCK_DGRAM</span></code> sockets are supported.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_MCTP</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>The only (current) value for the <code class="docutils literal notranslate"><span class="pre">protocol</span></code> argument is 0.</p>
<p>As with all socket address families, source and destination addresses are
specified with a <code class="docutils literal notranslate"><span class="pre">sockaddr</span></code> type, with a single-byte endpoint address:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="n">__u8</span>                <span class="n">mctp_eid_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">mctp_addr</span> <span class="p">{</span>
        <span class="n">mctp_eid_t</span>          <span class="n">s_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">sockaddr_mctp</span> <span class="p">{</span>
        <span class="n">__kernel_sa_family_t</span> <span class="n">smctp_family</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">int</span>         <span class="n">smctp_network</span><span class="p">;</span>
        <span class="k">struct</span> <span class="nc">mctp_addr</span>     <span class="n">smctp_addr</span><span class="p">;</span>
        <span class="n">__u8</span>                 <span class="n">smctp_type</span><span class="p">;</span>
        <span class="n">__u8</span>                 <span class="n">smctp_tag</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define MCTP_NET_ANY        0x0</span>
<span class="cp">#define MCTP_ADDR_ANY       0xff</span>
</pre></div>
</div>
</div>
<div class="section" id="syscall-behaviour">
<h3>Syscall behaviour<a class="headerlink" href="#syscall-behaviour" title="Permalink to this headline">¶</a></h3>
<p>The following sections describe the MCTP-specific behaviours of the standard
socket system calls. These behaviours have been chosen to map closely to the
existing sockets APIs.</p>
<div class="section" id="bind-set-local-socket-address">
<h4><code class="docutils literal notranslate"><span class="pre">bind()</span></code> : set local socket address<a class="headerlink" href="#bind-set-local-socket-address" title="Permalink to this headline">¶</a></h4>
<p>Sockets that receive incoming request packets will bind to a local address,
using the <code class="docutils literal notranslate"><span class="pre">bind()</span></code> syscall.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">sockaddr_mctp</span> <span class="n">addr</span><span class="p">;</span>

<span class="n">addr</span><span class="p">.</span><span class="n">smctp_family</span> <span class="o">=</span> <span class="n">AF_MCTP</span><span class="p">;</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_network</span> <span class="o">=</span> <span class="n">MCTP_NET_ANY</span><span class="p">;</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">MCTP_ADDR_ANY</span><span class="p">;</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_type</span> <span class="o">=</span> <span class="n">MCTP_TYPE_PLDM</span><span class="p">;</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_tag</span> <span class="o">=</span> <span class="n">MCTP_TAG_OWNER</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">bind</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="nc">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>
</pre></div>
</div>
<p>This establishes the local address of the socket. Incoming MCTP messages that
match the network, address, and message type will be received by this socket.
The reference to ‘incoming’ is important here; a bound socket will only receive
messages with the TO bit set, to indicate an incoming request message, rather
than a response.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">smctp_tag</span></code> value will configure the tags accepted from the remote side of
this socket. Given the above, the only valid value is <code class="docutils literal notranslate"><span class="pre">MCTP_TAG_OWNER</span></code>, which
will result in remotely “owned” tags being routed to this socket. Since
<code class="docutils literal notranslate"><span class="pre">MCTP_TAG_OWNER</span></code> is set, the 3 least-significant bits of <code class="docutils literal notranslate"><span class="pre">smctp_tag</span></code> are not
used; callers must set them to zero.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">smctp_network</span></code> value of <code class="docutils literal notranslate"><span class="pre">MCTP_NET_ANY</span></code> will configure the socket to
receive incoming packets from any locally-connected network. A specific network
value will cause the socket to only receive incoming messages from that network.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">smctp_addr</span></code> field specifies a local address to bind to. A value of
<code class="docutils literal notranslate"><span class="pre">MCTP_ADDR_ANY</span></code> configures the socket to receive messages addressed to any
local destination EID.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">smctp_type</span></code> field specifies which message types to receive. Only the
lower 7 bits of the type is matched on incoming messages (ie., the
most-significant IC bit is not part of the match). This results in the socket
receiving packets with and without a message integrity check footer.</p>
</div>
<div class="section" id="sendto-sendmsg-send-transmit-an-mctp-message">
<h4><code class="docutils literal notranslate"><span class="pre">sendto()</span></code>, <code class="docutils literal notranslate"><span class="pre">sendmsg()</span></code>, <code class="docutils literal notranslate"><span class="pre">send()</span></code> : transmit an MCTP message<a class="headerlink" href="#sendto-sendmsg-send-transmit-an-mctp-message" title="Permalink to this headline">¶</a></h4>
<p>An MCTP message is transmitted using one of the <code class="docutils literal notranslate"><span class="pre">sendto()</span></code>, <code class="docutils literal notranslate"><span class="pre">sendmsg()</span></code> or
<code class="docutils literal notranslate"><span class="pre">send()</span></code> syscalls. Using <code class="docutils literal notranslate"><span class="pre">sendto()</span></code> as the primary example:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">sockaddr_mctp</span> <span class="n">addr</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

<span class="cm">/* set message destination */</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_family</span> <span class="o">=</span> <span class="n">AF_MCTP</span><span class="p">;</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_network</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_tag</span> <span class="o">=</span> <span class="n">MCTP_TAG_OWNER</span><span class="p">;</span>
<span class="n">addr</span><span class="p">.</span><span class="n">smctp_type</span> <span class="o">=</span> <span class="n">MCTP_TYPE_ECHO</span><span class="p">;</span>

<span class="cm">/* arbitrary message to send, with message-type header */</span>
<span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MCTP_TYPE_ECHO</span><span class="p">;</span>
<span class="n">memcpy</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;hello, world!&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

<span class="n">len</span> <span class="o">=</span> <span class="n">sendto</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">(</span><span class="k">struct</span> <span class="nc">sockaddr_mctp</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>
</pre></div>
</div>
<p>The network and address fields of <code class="docutils literal notranslate"><span class="pre">addr</span></code> define the remote address to send to.
If <code class="docutils literal notranslate"><span class="pre">smctp_tag</span></code> has the <code class="docutils literal notranslate"><span class="pre">MCTP_TAG_OWNER</span></code>, the kernel will ignore any bits set
in <code class="docutils literal notranslate"><span class="pre">MCTP_TAG_VALUE</span></code>, and generate a tag value suitable for the destination
EID. If <code class="docutils literal notranslate"><span class="pre">MCTP_TAG_OWNER</span></code> is not set, the message will be sent with the tag
value as specified. If a tag value cannot be allocated, the system call will
report an errno of <code class="docutils literal notranslate"><span class="pre">EAGAIN</span></code>.</p>
<p>The application must provide the message type byte as the first byte of the
message buffer passed to <code class="docutils literal notranslate"><span class="pre">sendto()</span></code>. If a message integrity check is to be
included in the transmitted message, it must also be provided in the message
buffer, and the most-significant bit of the message type byte must be 1.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sendmsg()</span></code> system call allows a more compact argument interface, and the
message buffer to be specified as a scatter-gather list. At present no ancillary
message types (used for the <code class="docutils literal notranslate"><span class="pre">msg_control</span></code> data passed to <code class="docutils literal notranslate"><span class="pre">sendmsg()</span></code>) are
defined.</p>
<p>Transmitting a message on an unconnected socket with <code class="docutils literal notranslate"><span class="pre">MCTP_TAG_OWNER</span></code>
specified will cause an allocation of a tag, if no valid tag is already
allocated for that destination. The (destination-eid,tag) tuple acts as an
implicit local socket address, to allow the socket to receive responses to this
outgoing message. If any previous allocation has been performed (to for a
different remote EID), that allocation is lost.</p>
<p>Sockets will only receive responses to requests they have sent (with TO=1) and
may only respond (with TO=0) to requests they have received.</p>
</div>
<div class="section" id="recvfrom-recvmsg-recv-receive-an-mctp-message">
<h4><code class="docutils literal notranslate"><span class="pre">recvfrom()</span></code>, <code class="docutils literal notranslate"><span class="pre">recvmsg()</span></code>, <code class="docutils literal notranslate"><span class="pre">recv()</span></code> : receive an MCTP message<a class="headerlink" href="#recvfrom-recvmsg-recv-receive-an-mctp-message" title="Permalink to this headline">¶</a></h4>
<p>An MCTP message can be received by an application using one of the
<code class="docutils literal notranslate"><span class="pre">recvfrom()</span></code>, <code class="docutils literal notranslate"><span class="pre">recvmsg()</span></code>, or <code class="docutils literal notranslate"><span class="pre">recv()</span></code> system calls. Using <code class="docutils literal notranslate"><span class="pre">recvfrom()</span></code>
as the primary example:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">sockaddr_mctp</span> <span class="n">addr</span><span class="p">;</span>
<span class="kt">socklen_t</span> <span class="n">addrlen</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

<span class="n">addrlen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>

<span class="n">len</span> <span class="o">=</span> <span class="n">recvfrom</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">(</span><span class="k">struct</span> <span class="nc">sockaddr_mctp</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">addrlen</span><span class="p">);</span>

<span class="cm">/* We can expect addr to describe an MCTP address */</span>
<span class="n">assert</span><span class="p">(</span><span class="n">addrlen</span> <span class="o">&gt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
<span class="n">assert</span><span class="p">(</span><span class="n">addr</span><span class="p">.</span><span class="n">smctp_family</span> <span class="o">==</span> <span class="n">AF_MCTP</span><span class="p">);</span>

<span class="n">printf</span><span class="p">(</span><span class="s">&quot;received %zd bytes from remote EID %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">addr</span><span class="p">.</span><span class="n">smctp_addr</span><span class="p">);</span>
</pre></div>
</div>
<p>The address argument to <code class="docutils literal notranslate"><span class="pre">recvfrom</span></code> and <code class="docutils literal notranslate"><span class="pre">recvmsg</span></code> is populated with the
remote address of the incoming message, including tag value (this will be needed
in order to reply to the message).</p>
<p>The first byte of the message buffer will contain the message type byte. If an
integrity check follows the message, it will be included in the received buffer.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">recv()</span></code> system call behaves in a similar way, but does not provide a
remote address to the application. Therefore, these are only useful if the
remote address is already known, or the message does not require a reply.</p>
<p>Like the send calls, sockets will only receive responses to requests they have
sent (TO=1) and may only respond (TO=0) to requests they have received.</p>
</div>
</div>
</div>
<div class="section" id="kernel-internals">
<h2>Kernel internals<a class="headerlink" href="#kernel-internals" title="Permalink to this headline">¶</a></h2>
<p>There are a few possible packet flows in the MCTP stack:</p>
<ol class="arabic">
<li><p>local TX to remote endpoint, message &lt;= MTU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sendmsg()
 -&gt; mctp_local_output()
    : route lookup
    -&gt; rt-&gt;output() (== mctp_route_output)
       -&gt; dev_queue_xmit()
</pre></div>
</div>
</li>
<li><p>local TX to remote endpoint, message &gt; MTU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sendmsg()
-&gt; mctp_local_output()
    -&gt; mctp_do_fragment_route()
       : creates packet-sized skbs. For each new skb:
       -&gt; rt-&gt;output() (== mctp_route_output)
          -&gt; dev_queue_xmit()
</pre></div>
</div>
</li>
<li><p>remote TX to local endpoint, single-packet message:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mctp_pkttype_receive()
: route lookup
-&gt; rt-&gt;output() (== mctp_route_input)
   : sk_key lookup
   -&gt; sock_queue_rcv_skb()
</pre></div>
</div>
</li>
<li><p>remote TX to local endpoint, multiple-packet message:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mctp_pkttype_receive()
: route lookup
-&gt; rt-&gt;output() (== mctp_route_input)
   : sk_key lookup
   : stores skb in struct sk_key-&gt;reasm_head

mctp_pkttype_receive()
: route lookup
-&gt; rt-&gt;output() (== mctp_route_input)
   : sk_key lookup
   : finds existing reassembly in sk_key-&gt;reasm_head
   : appends new fragment
   -&gt; sock_queue_rcv_skb()
</pre></div>
</div>
</li>
</ol>
<div class="section" id="key-refcounts">
<h3>Key refcounts<a class="headerlink" href="#key-refcounts" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>keys are refed by:</p>
<ul>
<li><p>a skb: during route output, stored in <code class="docutils literal notranslate"><span class="pre">skb-&gt;cb</span></code>.</p></li>
<li><p>netns and sock lists.</p></li>
</ul>
</li>
<li><p>keys can be associated with a device, in which case they hold a
reference to the dev (set through <code class="docutils literal notranslate"><span class="pre">key-&gt;dev</span></code>, counted through
<code class="docutils literal notranslate"><span class="pre">dev-&gt;key_count</span></code>). Multiple keys can reference the device.</p></li>
</ul>
</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mpls-sysctl.html" class="btn btn-neutral float-right" title="MPLS Sysfs variables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="mac80211-injection.html" class="btn btn-neutral float-left" title="How to use packet injection with mac80211" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright The kernel development community.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>